## 项目名称：AI 驱动的文本转 Mermaid 图表 Web 应用

### 🎯 项目目标

开发一款 Web 应用程序，利用 AI 技术将用户输入或上传的文本内容智能转换为 Mermaid 格式的代码，并将其渲染成可视化图表展示给用户。

---

### ✨ 核心功能

1. **文本输入与处理**:
    
    - **手动输入**: 提供一个文本编辑区域，用户可以直接粘贴或输入文本内容。
    - **文件上传**:
        - 支持 `.txt`, `.md` (Markdown), `.docx` (Microsoft Word) 格式的文件。
        - 需要后端或前端处理文件解析，提取纯文本内容。
    - **内容预处理**: （可选，但建议）对提取的文本进行初步清洗，去除不必要的特殊字符或格式，以便更好地被 AI 模型理解。
    - **字符数限制**:
        - 输入文本（包括手动输入和文件上传解析后的文本）总长度上限为 20,000 字符。
        - 前端应有字数统计和超出提示。
        - 后端也应进行校验，防止超长文本提交。
2. **AI 文本转 Mermaid 代码**:
    - **AI 模型接口**:
        - 通过 API 请求与 AI 模型进行交互。
        - 接口协议遵循 OpenAI 兼容模式。
    - **核心转换逻辑**: 将预处理后的文本发送给 AI 模型，AI 模型分析文本内容并生成相应的 Mermaid 代码。
    - **Prompt 设计**: 需要精心设计 Prompt，引导 AI 模型准确理解文本内容并生成正确的 Mermaid 语法。可以考虑支持不同图表类型的生成（例如流程图、序列图、甘特图等），用户或许可以选择期望的图表类型。
3. **Mermaid 代码编辑与渲染**:
    - **Mermaid 代码展示**: 在一个区域清晰展示 AI 生成的 Mermaid 代码。
    - **代码编辑**: （建议）允许用户对 AI 生成的 Mermaid 代码进行手动修改和优化。
    - **实时渲染**:
        - 使用 **Excalidraw** 作为基础绘图工具。
        - 集成 **mermaid-to-excalidraw** 库，将 Mermaid 代码转换为 Excalidraw 的元素进行渲染。
        - 当 Mermaid 代码发生变化时（无论是 AI 生成还是用户修改），图表应能自动或手动触发重新渲染。
    - **渲染结果交互**: 利用 Excalidraw 的特性，渲染出的图表可能具备一定的交互能力（如拖拽、缩放等）。
4. **用户界面 (UI)**:
    - 清晰的布局，将文本输入区、Mermaid 代码区、渲染结果区分开。
    - 直观的操作按钮，如“上传文件”、“生成图表”、“复制代码”、“导出图表”（若 Excalidraw 支持）。

---

### 🛠️ 技术栈

1. **前端框架**: **Next.js** (最新版本)
    - API Routes 可用于处理文件上传或作为后端 AI 接口请求的代理。
2. **UI 组件库**: **shadcn/ui**
    - 提供高质量、可定制的 UI 组件。
3. **CSS 框架**: **Tailwind CSS**
    - 用于快速构建现代化、响应式的用户界面。
4. **Mermaid 渲染器**:
    - **Excalidraw**: 作为核心的绘图和展示画布。
    - **mermaid-to-excalidraw**: 用于将 Mermaid 语法字符串转换为 Excalidraw 场景数据。
    - **调研**: 务必查阅 `Excalidraw` 和 `mermaid-to-excalidraw` 的最新文档，了解其 API、集成方式、功能限制以及可能的配置项。

---

### 🤖 AI 集成

1. **接口配置**:
    - **URL**: AI 接口的请求地址。
    - **Key**: API 访问密钥。
    - **Model**: 指定使用的 AI 模型名称（如 `gpt-3.5-turbo`, `gpt-4` 等兼容模型）。
    - **环境变量**: 以上配置信息均通过**环境变量**进行管理 (`process.env.AI_API_URL`, `process.env.AI_API_KEY`, `process.env.AI_MODEL_NAME`)，确保安全性与灵活性。
2. **API 请求**:
    - 在后端（例如 Next.js API Routes）或前端（需注意 Key 的安全暴露问题，推荐后端代理）发起对 AI 接口的 HTTP 请求。
    - 请求体应包含用户文本和必要的 Prompt 指令。
    - 处理 API 的响应，提取生成的 Mermaid 代码。
3. **错误处理**:
    - 妥善处理 AI 接口请求可能出现的错误（如网络问题、API 限流、认证失败、内容生成失败等）。
    - 向用户提供友好的错误提示。

---

### 📄 输入/输出规范

1. **输入**:
    - 用户直接输入的纯文本。
    - `.txt`, `.md`, `.docx` 文件，解析为纯文本。
    - （可选）用户选择期望生成的图表类型。
2. **输出**:
    - **Mermaid 代码**: 由 AI 生成，可编辑。
    - **可视化图表**: 由 Mermaid 代码通过 Excalidraw 渲染得到。
    - （可选）允许用户复制代码或导出渲染后的图表（如 PNG, SVG，取决于 Excalidraw 的导出能力）。